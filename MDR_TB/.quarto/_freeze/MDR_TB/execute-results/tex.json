{
  "hash": "34a15c0924599bba05b879228786acd1",
  "result": {
    "markdown": "---\ntitle: \"EPIDEMIOLOGY OF MULTI-DRUG RESISTANT TB USING ISOLATES SENT TO THE NATIONAL TUBERCULOSIS REFERENCE LABORARY (2015-2016)\"\nformat:\n  pdf:\n    documentclass: report\n    keep-tex: true\n---\n\n\n# METHODS\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary('ggflowchart')\nflow_chart <- tibble::tibble(from = c(\"Total TB+ Entries recieved \n  8308\", \"Total TB+ Entries recieved \n  8308\", \"Entries after removing null values\n  2621\", \"Entries after removing null values\n  2621\", \"Null entries removed\n  2621\"),\n                             to= c(\"Entries after removing null values\n  2621\",\"Entries removed \n  5682\", \"Entries after removing Non-MDR\n  143\n  \", \"Null entries removed\n  2621\", \"MDR entries analyzed\n  143\"))\nggflowchart(flow_chart, colour = 'cyan', family = 'serif', x_nudge = 0.45)\n```\n\n::: {.cell-output-display}\n![](MDR_TB_files/figure-pdf/unnamed-chunk-1-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n## R Packages used\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#\\ label: load-packages\nsuppressPackageStartupMessages(library('tidyverse'))\n\n#install.packages('plotly')\n\n#install.packages('ggmap')\n\n#install.packages('forcats')\nsuppressPackageStartupMessages(library('ggmap'))\nsuppressPackageStartupMessages(library('plotly'))\nsuppressPackageStartupMessages(library('ggdist'))\nsuppressPackageStartupMessages(library('ggmap'))\n```\n:::\n\n\n# FUNCTIONS\n\n## Fisher's function\n\n\n::: {.cell}\n\n```{.r .cell-code}\nFishersfn <- function(df, var1, var2){\n\n  contingency_table <- table(df[[var1]], df[[var2]])\n\n  fisherExact <- fisher.test(contingency_table)\n\n  return (fisherExact)\n\n}\n```\n:::\n\n\n## Getting percentages\n\n\n::: {.cell}\n\n```{.r .cell-code}\npcts <- function(df, var_to_group_by) {\n\n  results <- df %>%\n\n    group_by_at(vars({{ var_to_group_by }})) %>%\n\n    summarise(counts = n()) %>%\n\n    mutate(Percentages = counts/sum(counts)*100)\n\n  \n\n  return(results)\n\n}\n```\n:::\n\n\nReading the file\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmdr_tb_df <- read.csv('mdr_tbv4.csv')\n```\n:::\n\n\nCreating a new column to define MDR_TYPE\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmdr_tb_df$MDR_TYPE <- NA\n```\n:::\n\n\nHere I have defined Rpob + katg as MDRKR (MDR KatG and RpoB), as well as those that are rpob + katg + inha\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmdr_tb_dfv1 <- mdr_tb_df$MDR_TYPE[mdr_tb_df$RpoB == 'Resistant' & mdr_tb_df$KatG == 'Resistant'] <- 'MDRKR'\n\nmdr_tb_df$MDR_TYPE[mdr_tb_df$RpoB == 'Resistant' & mdr_tb_df$KatG != 'Resistant' & mdr_tb_df$inhA == 'Resistant'] <- 'MDRIR'\n\nmdr_tb_dfv1 <- mdr_tb_df %>% select(-RpoB, -KatG, -inhA)\n```\n:::\n\n\n# VISUALIZATIONS\n\nSetting theme\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntheme_set(theme_gray())\n\ntheme_update(\n\n  plot.margin = margin(rep(20, 4))\n\n)\n```\n:::\n\n\n## HIV BAR PLOT\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhivbar <- ggplot(mdr_tb_dfv1, mapping = aes(x=HIV_STATUS)) + geom_bar(mapping = aes(fill = HIV_STATUS)) + ggtitle('HIV status and multidrug resistance in 2015-2016 samples from NTRL')\nhivbar\n```\n\n::: {.cell-output-display}\n![](MDR_TB_files/figure-pdf/unnamed-chunk-9-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n## TB TYPE BAR PLOT\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntb_type_bar <- ggplot(mdr_tb_dfv1, mapping = aes(x=TB_TYPE)) + geom_bar(mapping = aes(fill = TB_TYPE)) + ggtitle('TB Type and multidrug resistance\n                                                                                                                 in 2015-2016 samples from NTRL')\n```\n:::\n\n\n## SMEAR BAR PLOT\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsmearBar <- ggplot(mdr_tb_dfv1, mapping = aes(x=SMEAR)) + geom_bar(mapping = aes(fill = SMEAR)) + ggtitle('Smear results and multidrug resistance in 2015-2016 samples from NTRL')\nsmearBar \n```\n\n::: {.cell-output-display}\n![](MDR_TB_files/figure-pdf/unnamed-chunk-11-1.pdf){fig-pos='H'}\n:::\n:::\n\n\nAge groups based on WHO typical age divisions\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmdr_tb_dfv3 <- mdr_tb_dfv1 %>%   mutate(\n  # Create categories\n  age_group = dplyr::case_when(\n    AGE <= 4            ~ \"0-4\",\n    AGE > 4 & AGE <= 14 ~ \"5-14\",\n    AGE > 14 & AGE<= 24 ~ \"15-24\",\n    AGE > 24 & AGE <= 34  ~ \"25-34\",\n    AGE > 34 & AGE <= 44 ~ \"35-44\",\n    AGE > 44 & AGE <= 54 ~ \"45-54\",\n    AGE > 54 & AGE <= 64 ~ \"65+\",\n    AGE >= 64 ~ \"35-44\"\n  ),\n  # Convert to factor\n  age_group = factor(\n    age_group,\n    level = c(\"0-4\", \"5-14\",\"15-24\",\"25-34\",\"35-44\",\"45-54\", \"65+\")\n  )\n)\n```\n:::\n\n\n## LOLLIPOP PLOT FOR COUNTY/GEOGRAPHICAL DISTRIBUTION\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngeoGrpsPcts <- pcts(mdr_tb_dfv1, 'Province')\n\nGeoPops <- geoGrpsPcts %>%\n\n  arrange(desc(Percentages)) %>% \n\n  mutate( Province = forcats::fct_reorder(Province, Percentages)) %>%\n\n  ggplot(aes(x=Province, y=Percentages)) +\n\n  geom_point(color = 'orange') +\n\n  geom_segment(aes(x=Province, y=Percentages, xend=Province, yend=0, color = 'red')) +\n\n  theme(axis.text.x = element_text(angle = 90), panel.background = element_rect(fill = 'lightblue'), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), plot.title = element_text(color='#6699CC', size = 10, face = 'bold')) +\n\n  labs(title = 'MDR TB: Percentage of MDR TB cases by region/county reported to the NTRL', y= 'Percentage (%) per county', x='County') +\n\n  guides(color = 'none')\nGeoPops \n```\n\n::: {.cell-output-display}\n![](MDR_TB_files/figure-pdf/unnamed-chunk-13-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n## AGE GROUP BAR PLOT\n\n\n::: {.cell}\n\n```{.r .cell-code}\nage_groupBars <- mdr_tb_dfv3 %>%\n\n  group_by(age_group) %>%\n\n  summarise(counts = n())\n\nggplot() +\n\n  geom_bar(data = age_groupBars, aes(x = age_group, y = counts, fill = age_group), stat = \"identity\") +\n\n  labs(title = 'Age distribution of MDR isolates subitted to the NTRL between 2015-2015')\n```\n\n::: {.cell-output-display}\n![](MDR_TB_files/figure-pdf/unnamed-chunk-14-1.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\nage_groupBars\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 7 x 2\n  age_group counts\n  <fct>      <int>\n1 0-4            5\n2 5-14           2\n3 15-24         15\n4 25-34         61\n5 35-44         36\n6 45-54         20\n7 65+            4\n```\n:::\n:::\n\n\n# **INFERENTIAL STATISTICS**\n\n## Fishers exact test for HIV status\n\n\n::: {.cell}\n\n```{.r .cell-code}\np_value <- Fishersfn(mdr_tb_dfv3, 'HIV_STATUS', 'MDR_TYPE')\np_value \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tFisher's Exact Test for Count Data\n\ndata:  contingency_table\np-value = 0.2897\nalternative hypothesis: two.sided\n```\n:::\n:::\n\n\n## Fisher's exact test for age\n\n\n::: {.cell}\n\n```{.r .cell-code}\np_value <- Fishersfn(mdr_tb_dfv3, 'age_group', 'MDR_TYPE')\np_value \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tFisher's Exact Test for Count Data\n\ndata:  contingency_table\np-value = 0.175\nalternative hypothesis: two.sided\n```\n:::\n:::\n\n\n## Fisher's exact test for COUNTY\n\n\n::: {.cell}\n\n```{.r .cell-code}\np_value <- Fishersfn(mdr_tb_dfv1, 'Province', 'MDR_TYPE')\np_value\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tFisher's Exact Test for Count Data\n\ndata:  contingency_table\np-value = 0.06311\nalternative hypothesis: two.sided\n```\n:::\n:::\n\n\n## Fisher's exact test for TB type\n\n\n::: {.cell}\n\n```{.r .cell-code}\np_value <- Fishersfn(mdr_tb_dfv1, 'TB_TYPE', 'MDR_TYPE')\np_value\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tFisher's Exact Test for Count Data\n\ndata:  contingency_table\np-value = 0.9482\nalternative hypothesis: two.sided\n```\n:::\n:::\n\n\n## Fisher's exact test for GENDER\n\n\n::: {.cell}\n\n```{.r .cell-code}\np_value <- Fishersfn(mdr_tb_dfv1, 'GENDER', 'MDR_TYPE')\np_value\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tFisher's Exact Test for Count Data\n\ndata:  contingency_table\np-value = 0.3319\nalternative hypothesis: true odds ratio is not equal to 1\n95 percent confidence interval:\n 0.5015292 9.1443367\nsample estimates:\nodds ratio \n  2.088592 \n```\n:::\n:::\n\n\n## Fisher's exact test for SMEARS\n\n\n::: {.cell}\n\n```{.r .cell-code}\np_value <- Fishersfn(mdr_tb_dfv1, 'SMEAR', 'MDR_TYPE')\np_value\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tFisher's Exact Test for Count Data\n\ndata:  contingency_table\np-value = 0.7377\nalternative hypothesis: two.sided\n```\n:::\n:::\n\n\n# More characterizations\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmdr_tb_dfv5 <- mdr_tb_df$MDR_TYPE[mdr_tb_df$RpoB == 'Resistant' & mdr_tb_df$KatG == 'Resistant' & mdr_tb_df$inhA == 'Resistant'] <- 'MDR+'\n```\n:::\n\n\n# Percentages of the MDR types\n\n\n::: {.cell}\n\n```{.r .cell-code}\npcts(mdr_tb_df, 'MDR_TYPE')\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 x 3\n  MDR_TYPE counts Percentages\n  <chr>     <int>       <dbl>\n1 MDR+          7        4.90\n2 MDRIR        11        7.69\n3 MDRKR       125       87.4 \n```\n:::\n:::\n\n\nTABLES OF DEMOGRAPHIC DISTRIBUTION OF MDR TYPES\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(mdr_tb_df$Province, mdr_tb_df$MDR_TYPE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n               \n                MDR+ MDRIR MDRKR\n  Baringo          1     0     4\n  Bomet            0     1     0\n  Bungoma          0     0     1\n  Embu             0     0     3\n  Garissa          1     0     0\n  Isiolo           0     0     1\n  Kajiado          1     0     3\n  Kiambu           0     0     4\n  Kilifi           0     0     3\n  Kirinyaga        0     1     5\n  Kitui            0     1    11\n  Kwale            0     0     2\n  Laikipia         0     0     4\n  Machakos         0     0     7\n  Makueni          0     0     2\n  Meru             1     1     2\n  Mombasa          0     0    10\n  Nairobi          2     1    31\n  Nakuru           0     0    10\n  Narok            0     0     1\n  Nyandarua        0     0     2\n  Nyeri            0     0     2\n  Samburu          0     1     2\n  South Sudan      1     2     6\n  Taita Taveta     0     0     1\n  Tana River       0     1     0\n  Tharaka Nithi    0     0     1\n  Turkana          0     0     3\n  Uasin Gishu      0     1     1\n  West Pokot       0     1     3\n```\n:::\n\n```{.r .cell-code}\ntable(mdr_tb_df$HIV_STATUS, mdr_tb_df$MDR_TYPE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          \n           MDR+ MDRIR MDRKR\n  NEGATIVE    2     3    66\n  NOT_DONE    3     5    37\n  POSITIVE    2     3    22\n```\n:::\n\n```{.r .cell-code}\ntable(mdr_tb_df$SMEAR, mdr_tb_df$MDR_TYPE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        \n         MDR+ MDRIR MDRKR\n  1+        2     5    40\n  2+        2     2    21\n  3+        1     2    44\n  NEG       1     0     1\n  SCANTY    1     2    19\n```\n:::\n\n```{.r .cell-code}\ntable(mdr_tb_df$TB_TYPE, mdr_tb_df$MDR_TYPE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n            \n             MDR+ MDRIR MDRKR\n  FA_1STL_TR    1     3    31\n  FA_RE_TREA    0     0     3\n  MDR_CONTA     0     0     3\n  MDR_F         1     1    22\n  NEW           1     4    26\n  RE_AF_DEFA    0     1    13\n  SP_SM_NR      0     0     3\n  SP_SM_PR      4     2    23\n  UNKNOWN       0     0     1\n```\n:::\n:::\n",
    "supporting": [
      "MDR_TB_files/figure-pdf"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}